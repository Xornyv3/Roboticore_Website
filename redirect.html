<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LinkedIn Authorization</title>
</head>
<body>
    <h1>LinkedIn Authorization</h1>
    <p id="status-message">Processing...</p>

<script>
          // Get the authorization code from the URL parameters
  const urlParams = new URLSearchParams(window.location.search);
  const authorizationCode = urlParams.get('code');

  if (authorizationCode) {
    // Exchange the authorization code for an access token
    fetch('https://www.linkedin.com/oauth/v2/accessToken', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded'
      },
      body: new URLSearchParams({
        grant_type: 'authorization_code',
        code: authorizationCode,
        redirect_uri: 'http://127.0.0.1:5500/redirect.html', // Your redirect URI
        client_id: '78ej28syhnc6oh', // Your LinkedIn Client ID
        client_secret: 'MkOnibH8qfkQMxOK' // Your LinkedIn Client Secret
      })
    })
    .then(response => response.json())
    .then(data => {
      console.log('Access Token:', data.access_token);
      // Store the access token in localStorage or a secure location
      localStorage.setItem('linkedin_access_token', data.access_token);
      // Redirect or update the UI
      window.location.href = 'your_main_page.html'; // Redirect to your main page or update UI
    })
    .catch(error => console.error('Error:', error));
  } else {
    console.error('Authorization code not found in URL');
  }

        function postCertificateToLinkedIn(accessToken, state) {
            const certificate = {
                'JohnDoe': {
                    imageUrl: 'path_to_johndoe_image.jpg',
                },
                'Mehdi-Bahlaoui': {
                    imageUrl: 'path_to_mehdi_image.jpg',
                },
                'Abdoullah-Alalgui': {
                    imageUrl: 'img/abdo.jpeg',
                },
                // Add more certificates as needed
            };

            const imageUrl = certificate[state]?.imageUrl;

            if (imageUrl) {
                const apiUrl = 'https://api.linkedin.com/v2/shares';
                const postData = {
                    content: {
                        contentEntities: [
                            {
                                entityLocation: imageUrl,
                                thumbnails: [
                                    {
                                        resolvedUrl: imageUrl
                                    }
                                ]
                            }
                        ],
                        title: 'Certificate Verification'
                    },
                    distribution: {
                        linkedInDistributionTarget: {}
                    },
                    owner: 'urn:li:person:{your_person_urn}', // Replace with your LinkedIn person URN
                    subject: 'Check out this certificate!',
                    text: {
                        text: 'I have verified my certificate. Check it out!'
                    }
                };

                fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${accessToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(postData)
                })
                .then(response => response.json())
                .then(data => {
                    document.getElementById('status-message').innerText = 'Certificate posted successfully!';
                })
                .catch(error => {
                    console.error('Error posting certificate to LinkedIn:', error);
                    document.getElementById('status-message').innerText = 'Error posting certificate to LinkedIn.';
                });
            } else {
                document.getElementById('status-message').innerText = 'Invalid certificate ID.';
            }
        }
    </script>
</body>
</html>
